---
id: "2026-02-07"
aliases: []
tags: []
---

**Задача: Фильтрация данных по скважинам и расчет перцентилей**

**Контекст:**
Имеется исходная таблица с данными по скважинам. Необходимо написать функцию, которая будет выполнить операции фильтрации и агрегации для статистического анализа.

**Исходные данные:**

- Таблица с колонками, включающими: `Статус`, `Well` (название скважины), а также другие числовые колонки для анализа.

| num   | date       | well  | QOIL      | QWAT       | QWIN | BHPH       | THPH    | WEFA     | QLIQ       | WCT                  | status | SBHPH  | STHPH  | SQLIQ              | SWCT               | SOIL               | SPROD               | PROD               |
| ----- | ---------- | ----- | --------- | ---------- | ---- | ---------- | ------- | -------- | ---------- | -------------------- | ------ | ------ | ------ | ------------------ | ------------------ | ------------------ | ------------------- | ------------------ |
| 11588 | 2020-09-01 | 14312 | 16.276403 | 248.214885 | 0.0  |            |         | 0.988125 | 264.491288 | 0.9384614777935522   | prod   | 102.87 | 156.18 | 227.31554582347627 | 0.9420739254572459 | 13.167497252097524 | 4.2639242993115     |                    |
| 13380 | 2020-09-01 | 14314 | 1.349086  | 33.232997  | 0.0  |            |         | 0.986458 | 34.582083  | 0.9609888739206369   | prod   | 128.38 | 157.57 | 29.921465527952112 | 0.9410128252827656 | 1.7649827148930162 | 1.0250552734419827  |                    |
| 16068 | 2020-09-01 | 14316 | 12.490916 | 244.026582 | 0.0  |            |         | 0.988125 | 256.517498 | 0.9513057935720237   | prod   | 73.64  | 147.90 | 233.25665998017553 | 0.9449254102218675 | 12.846514861425506 | 3.1411970012009505  |                    |
| 21444 | 2020-09-01 | 14323 | 2.054038  | 0.523202   | 0.0  |            |         | 0.996875 | 2.57724    | 0.20300864490695472  | prod   | 60.30  | 97.77  | 2.5133445963459087 | 0.2125099283580967 | 1.97923391623723   | 0.06707733891624817 |                    |
| 22340 | 2020-09-01 | 14324 | 3.698955  | 62.438398  | 0.0  |            |         | 0.013889 | 66.137353  | 0.9440716201629661   | prod   | 80.11  | 135.49 | 43.50396286287119  | 0.9425143484182938 | 2.500853651558497  | 0.7854594600801582  |                    |
| 25028 | 2020-09-01 | 14326 | 1.020271  | 18.885083  | 0.0  |            |         | 0.020111 | 19.905354  | 0.948743890714026    | prod   | 66.91  | 142.15 | 56.815684501307054 | 0.9529939823614544 | 2.6706790678144823 | 0.755161482944773   |                    |
| 30404 | 2020-09-01 | 14333 | 4.11545   | 12.2467    | 0.0  | 136.079475 |         | 0.983514 | 16.36215   | 0.7484774311444401   | prod   | 139.69 | 141.45 | 16.326613662122703 | 0.6584592605487464 | 5.576203702896328  | 9.285924685558275   |                    |
| 31300 | 2020-09-01 | 14336 | 18.436382 | 123.462314 | 0.0  | 48.332025  | 149.961 | 0.986208 | 141.898696 | 0.870073633375743    | prod   | 61.32  | 135.64 | 156.28394686403348 | 0.8661618578439354 | 20.91675309709936  | 2.102781267601643   | 1.3962425184353182 |
| 32196 | 2020-09-01 | 14337 | 49.395281 | 189.051625 | 0.0  | 68.799675  | 95.2455 | 0.982181 | 238.446906 | 0.kk7928457876488445 | prod   | 96.74  | 126.94 | 246.65972744952816 | 0.9009834195372881 | 24.42340274991679  | 8.167890372740372   | 9.016429096086052  |

**Требования к выполнению:**

**1. Фильтрация данных:**
_ **По статусу:** Отфильтровать таблицу по столбцу `Статус`, оставив только строки, где значение статуса равно одному из трех: **"prod"**, **"not work"**, **"inj"**.
_ **По скважинам:** Реализовать опциональную фильтрацию по колонке `Well`. Фильтр должен принимать на вход список названий скважин и оставлять в таблице только соответствующие строки. Если список скважин не предоставлен, этот шаг пропускается.

**2. Расчет статистик:** \* Для **всех числовых колонок** в отфильтрованной таблице рассчитать три перцентиля: **10-й (P10), 50-й (медиана, P50) и 90-й (P90)**.

**3. Формирование результата:**
_ На основании рассчитанных перцентилей сформировать **три отдельных файла** (например, в формате CSV):
_ Файл **`P10.csv`** со значениями 10-го перцентиля для каждой числовой колонки.
_ Файл **`P50.csv`** со значениями медианы (50-й перцентиль) для каждой числовой колонки.
_ Файл **`P90.csv`** со значениями 90-го перцентиля для каждой числовой колонки. \* Структура файлов: в каждом файле должна быть одна строка (или столбец) со значениями соответствующего перцентиля для всех числовых признаков.

**Ключевые технические моменты:**

- код функции должен быть максимально простым
- максимально использовать возможности pandas для работы с данными
- Обеспечить гибкость в передаче списка скважин для фильтрации.
- Автоматически определить все числовые колонки в отфильтрованном датасете для расчета перцентилей.
- Итоговые файлы должны быть названы строго `P10`, `P50`, `P90`.

**Ожидаемый результат:**

1.  Отфильтрованный по заданным условиям датасет.
2.  Три файла (`P10.csv`, `P50.csv`, `P90.csv`) с рассчитанными перцентилями для всех числовых колонок.
